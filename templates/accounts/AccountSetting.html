{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">

<div class="dashboard-container">
  <h1 class="welcome-title">Account Settings</h1>

  <!-- Update name + email -->
  <div class="section-box">
    <h2 class="section-title">Profile</h2>
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="action" value="update_profile">

      <div style="margin-bottom: 15px;">
        <label>First name</label><br>
        {{ profile_form.first_name }}
      </div>
      <div style="margin-bottom: 15px;">
        <label>Last name</label><br>
        {{ profile_form.last_name }}
      </div>
      <div style="margin-bottom: 15px;">
        <label>Email</label><br>
        {{ profile_form.email }}
      </div>

      <button type="submit" class="pixel-button">Save Profile</button>
    </form>
  </div>

  <!-- Change password -->
  <div class="section-box">
    <h2 class="section-title">Change Password</h2>
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="action" value="change_password">

      <div style="margin-bottom: 15px;">
        <label>Current password</label><br>
        {{ password_form.old_password }}
      </div>
      <div style="margin-bottom: 15px;">
        <label>New password</label><br>
        {{ password_form.new_password1 }}
      </div>
      <div style="margin-bottom: 15px;">
        <label>Confirm new password</label><br>
        {{ password_form.new_password2 }}
      </div>

      <button type="submit" class="pixel-button">Update Password</button>
    </form>
  </div>

  <!-- Delete account -->
  <div class="section-box" style="border-color:#ff0000; box-shadow:6px 6px 0 #000;">
    <h2 class="section-title">Danger Zone</h2>
    <p style="font-family:'Courier New', monospace; color:#333;">
      Deleting your account will remove your user and all related data.
      This cannot be undone.
    </p>

    <button id="delete-account-btn"
            class="pixel-button"
            style="background:#ff4d4d; margin-top:15px;">
      Delete Account
    </button>

    <!-- Hidden delete form -->
    <form id="delete-account-form" method="post" style="display:none;">
      {% csrf_token %}
      <input type="hidden" name="action" value="delete_account">
    </form>
  </div>
</div>

<!-- Simple popup modal -->
<style>
.settings-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
.settings-modal {
  background: #ffffff;
  border: 4px solid #000;
  box-shadow: 6px 6px 0 #000;
  padding: 20px;
  max-width: 400px;
  width: 90%;
  font-family: 'Courier New', monospace;
  text-align: center;
}
.settings-modal-title {
  font-weight: bold;
  font-size: 1.4em;
  margin-bottom: 10px;
}
.settings-modal-buttons {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  gap: 15px;
}
</style>

<div id="delete-modal" class="settings-modal-overlay">
  <div class="settings-modal">
    <div class="settings-modal-title">Delete Account?</div>
    <p>Are you sure you want to delete your account? This action cannot be undone.</p>
    <div class="settings-modal-buttons">
      <button id="cancel-delete" class="pixel-button" type="button"
              style="background:#cccccc;">Cancel</button>
      <button id="confirm-delete" class="pixel-button" type="button"
              style="background:#ff4d4d;">Yes, Delete</button>
    </div>
  </div>
</div>

<script>
  const deleteBtn   = document.getElementById("delete-account-btn");
  const deleteForm  = document.getElementById("delete-account-form");
  const deleteModal = document.getElementById("delete-modal");
  const cancelBtn   = document.getElementById("cancel-delete");
  const confirmBtn  = document.getElementById("confirm-delete");

  if (deleteBtn) {
    deleteBtn.addEventListener("click", function (e) {
      e.preventDefault();
      deleteModal.style.display = "flex";
    });
  }

  if (cancelBtn) {
    cancelBtn.addEventListener("click", function () {
      deleteModal.style.display = "none";
    });
  }

  if (confirmBtn) {
    confirmBtn.addEventListener("click", function () {
      deleteForm.submit();
    });
  }
</script>

{% endblock %}
